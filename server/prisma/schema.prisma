generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
 
}

model User {
  id                  String     @id @default(cuid())
  login               String?     @unique                         // “найти уникальную запись”
  passwordHash        String?
  username            String?    @unique                         // “найти уникальную запись” @ => для одного поля
  avatar              String? 
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt
  accounts            Account[]                                  // “привязки к провайдерам”. виртуальное поле на уровне ORM

 //  User может быть владельцем МНОГИХ комнат
  ownedRooms         Room[]      @relation("RoomOwner")          

 // User может быть участником МНОГИХ комнат
  roomAdmissions RoomAdmission[]                                   // Мои членства в комнатах
  joinedRooms Room[]              @relation("UserJoinedRooms")    // Комнаты где я УЧАСТНИК
}


model Room {
  id                  String     @id @default(cuid())
  nameRoom            String
  isPrivate           Boolean   @default(false)

  // Room имеет только ОДНОГО владельца
  ownerId             String
  owner   User        @relation("RoomOwner", fields: [ownerId], references: [id])

  admissions RoomAdmission[]                                     // Все членства в этой комнате
  members    User[]   @relation("UserJoinedRooms")               // Все участники комнаты
}

model RoomAdmission {
  id                  String     @id @default(cuid())
  userId              String
  roomId              String

  user                User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  room                Room       @relation(fields: [roomId], references: [id], onDelete: Cascade)

  // чтобы один и тот же user не был дважды добавлен в одну и ту же комнату
  @@unique([userId, roomId])

  @@index([userId])
  @@index([roomId])

}



model Account {
  id                  String     @id @default(cuid())
  provider            String                                    // Кто выдал аккаунт ("google", "github", "facebook")
  providerAccountId   String                                    // ID пользователя у провайдера
  userId              String                                    // внешний ключ (foreign key), ссылка на User.id
  user                User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  @@unique([provider, providerAccountId])                       // @@unique защищает от дубликатов У одного провайдера один accountId может существовать только один раз
  @@index([userId])                                             // @@index ускоряет работу, @@ => для всей модели
}



